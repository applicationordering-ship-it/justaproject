<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Demonstrasi dinein</title>
<style>
  :root{
    --accent:#ff6b00;
    --muted:#666;
    --card:#fff;
    --bg:#f4f5f7;
    --glass: rgba(255,255,255,0.95);
  }
  html,body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:#111;min-height:100%}
  
  /* FIX: Added padding-bottom so the floating button doesn't cover content */
  .app{max-width:980px;margin:0 auto;padding:16px;padding-bottom:100px}
  
  header{display:flex;align-items:center;gap:12px;margin-top:10px}
  header h1{margin:0;font-size:20px}
  .note{font-size:13px;color:var(--muted)}
  .controls{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
  .btn{background:var(--accent);color:#fff;padding:12px 16px;border-radius:10px;border:0;cursor:pointer;font-weight:600;display:inline-flex;align-items:center;justify-content:center;gap:8px}
  .btn.secondary{background:#fff;color:var(--accent);border:1px solid #eee}
  .btn.ghost{background:transparent;color:var(--accent);border:1px dashed #ffd0b8}
  
  .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.05);margin-top:16px}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px;margin-top:12px}
  
  /* FIX: Prevent text clipping in menu items */
  .menu-item{display:flex;gap:12px;align-items:center;padding:10px;border-radius:10px;border:1px solid #f0f0f0;background:#fff}
  .item-info{flex:1;min-width:0}
  .item-title{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .item-price{font-size:13px;color:var(--muted);margin-top:2px}
  
  .qty{display:inline-flex;align-items:center;border-radius:999px;background:#f8f9fa;border:1px solid #eee}
  .qty button{width:36px;height:36px;border:0;background:transparent;cursor:pointer;font-weight:700;font-size:18px}
  .qty .count{padding:0 4px;min-width:24px;text-align:center;font-weight:600}
  
  .finish-floating{position:fixed;left:0;right:0;bottom:0;padding:20px;background:linear-gradient(to top, var(--bg) 60%, transparent);z-index:60;display:flex;justify-content:center}
  .hidden{display:none !important}
  
  /* Modal fixes to prevent screen clipping */
  #scannerModal, #summaryModal{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:100;padding:16px}
  .modal-card{width:100%;max-width:500px;background:#fff;padding:20px;border-radius:16px;max-height:90vh;overflow-y:auto}
  
  video{width:100%;height:auto;border-radius:10px;background:#000;transform: scaleX(-1)}
  .summary-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px dashed #eee}
  footer{margin-top:30px;padding:20px 0;text-align:center;font-size:12px;color:var(--muted);border-top:1px solid #eee}
  
  @media (min-width:780px){header h1{font-size:24px}}
</style>
</head>
<body>

<div class="app">
  <header>
    <div style="width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,#ffd9c2,#ff6b00)"></div>
    <div>
      <h1>Dine-in</h1>
      <div class="note">Welcome to the ordering system.</div>
    </div>
  </header>

  <div class="controls">
    <button id="dineBtn" class="btn">üçΩÔ∏è Dine In</button>
    <button id="takeawayBtn" class="btn secondary">üõçÔ∏è Takeaway</button>
    <button id="help" class="btn ghost">‚ùì Help</button>
  </div>

  <div class="card">
    <strong>Menu</strong>
    <div id="nasgorList" class="grid"></div>
    <div id="mainsList" class="grid"></div>
    <div id="drinksList" class="grid"></div>
  </div>

  <div id="orderStatus" class="card hidden"></div>

  <footer>
    <div>Please settle your bill at the counter.</div>
  </footer>
</div>

<div class="finish-floating hidden" id="finishWrap">
  <button id="finishBtn" class="btn" style="width:100%; max-width:400px; box-shadow:0 4px 15px rgba(255,107,0,0.3)">
    Finish Order ‚Ä¢ <span id="cartCount">0</span> items
  </button>
</div>

<div id="summaryModal" class="hidden">
  <div class="modal-card">
    <h3>Order Summary</h3>
    <div id="summaryList"></div>
    <div style="margin-top:20px; display:flex; justify-content:space-between; font-weight:800; font-size:18px">
      <span>Total</span>
      <span id="summaryTotal">Rp 0</span>
    </div>
    <div style="margin-top:20px; display:grid; grid-template-columns:1fr 1fr; gap:10px">
      <button id="closeSummary" class="btn secondary">Back</button>
      <button id="placeOrderBtn" class="btn">Place Order</button>
    </div>
  </div>
</div>

<script src="https://cdn.ably.io/lib/ably.min-1.js"></script>
<script>
const ABLY_KEY = ''; 
const GOFILE_BASE = 'https://applicationordering-ship-it.github.io/justaproject/'; 

const MENU = {
  nasigoreng: [{ id: 'ng_ayam', name: 'Chicken Fried Rice', price: 28000, icon: 'nasi_goreng_ayam.png' }],
  mains: [{ id: 'ch_pep', name: 'Chicken Pepperoni Feast', price: 18000, icon: 'ch_pepperoni.png' }],
  drinks: [{ id: 'milo', name: 'Milo', price: 15000, icon: 'milo.png' }]
};

let cart = {}; 
const id = (s)=>document.getElementById(s);
const fmt = (n)=> new Intl.NumberFormat('id-ID', { style:'currency', currency:'IDR', maximumFractionDigits:0 }).format(n);

function makeItemCard(it){
  const el = document.createElement('div');
  el.className = 'menu-item';
  
  el.innerHTML = `
    <div style="width:54px;height:54px;background:#eee;border-radius:8px"></div>
    <div class="item-info">
      <div class="item-title">${it.name}</div>
      <div class="item-price">${fmt(it.price)}</div>
    </div>
    <div class="qty">
      <button class="minus">‚àí</button>
      <div class="count">0</div>
      <button class="plus">+</button>
    </div>
  `;

  // Attach logic directly to the buttons within this card
  const countEl = el.querySelector('.count');
  el.querySelector('.minus').onclick = () => changeQty(it, -1, countEl);
  el.querySelector('.plus').onclick = () => changeQty(it, 1, countEl);

  return el;
}

function changeQty(item, delta, countEl){
  const current = cart[item.id] ? cart[item.id].qty : 0;
  const next = Math.max(0, current + delta);
  
  if (next === 0) delete cart[item.id];
  else cart[item.id] = { item, qty: next };
  
  countEl.textContent = next;
  refreshFinishButton();
}

function refreshFinishButton(){
  const count = Object.values(cart).reduce((s,c)=>s+c.qty,0);
  id('cartCount').textContent = count;
  id('finishWrap').classList.toggle('hidden', count === 0);
}

function renderMenu(){
  Object.keys(MENU).forEach(cat => {
    const container = id(cat + 'List');
    if(container) MENU[cat].forEach(it => container.appendChild(makeItemCard(it)));
  });
}

id('finishBtn').onclick = () => {
  const list = id('summaryList');
  list.innerHTML = '';
  let total = 0;
  Object.values(cart).forEach(c => {
    total += c.item.price * c.qty;
    list.innerHTML += `<div class="summary-row"><span>${c.qty}x ${c.item.name}</span><span>${fmt(c.item.price * c.qty)}</span></div>`;
  });
  id('summaryTotal').textContent = fmt(total);
  id('summaryModal').classList.remove('hidden');
};

id('closeSummary').onclick = () => id('summaryModal').classList.add('hidden');

document.addEventListener('DOMContentLoaded', renderMenu);
</script>
</body>
</html>
